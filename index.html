
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>–¢—Ä–µ–Ω–∞–∂—ë—Ä –∏–≤—Ä–∏—Ç–æ-—Ä—É—Å—Å–∫–∏—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤ —Å –æ–∑–≤—É—á–∫–æ–π</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>üß† –¢—Ä–µ–Ω–∞–∂—ë—Ä –∏–≤—Ä–∏—Ç–æ-—Ä—É—Å—Å–∫–∏—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤</h1>
  <div id="word">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  <button id="repeat">üîà –ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
  <div id="options"></div>
  <div id="feedback"></div>
  <button id="skip">üóë –ù–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å —ç—Ç–æ —Å–ª–æ–≤–æ</button>
  <button id="restart" style="display:none">üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
  <div id="progress">–í—ã—É—á–µ–Ω–æ: 0 –∏–∑ 93</div>

<script>
  let allTerms = [];
  let terms = [];
  let audioMap = {};
  let current = null;

  function playAudio(hebrew) {
    const filename = audioMap[hebrew];
    if (filename) {
      const audio = new Audio("audio/" + encodeURIComponent(filename));
      audio.play();
    }
  }

  function updateProgress() {
    const learned = allTerms.length - terms.length;
    const total = allTerms.length;
    document.getElementById("progress").innerText = `–í—ã—É—á–µ–Ω–æ: ${learned} –∏–∑ ${total}`;
  }

  function fadeAndThen(callback) {
    const wordEl = document.getElementById("word");
    wordEl.classList.add("fade-out");
    setTimeout(() => {
      wordEl.classList.remove("fade-out");
      callback();
    }, 500);
  }

  function showWord() {
    updateProgress();
    if (terms.length === 0) {
      document.getElementById("word").innerText = "üéâ –í—Å–µ —Å–ª–æ–≤–∞ –∏–∑—É—á–µ–Ω—ã!";
      document.getElementById("options").innerHTML = "";
      document.getElementById("feedback").innerText = "";
      document.getElementById("repeat").style.display = "none";
      document.getElementById("skip").style.display = "none";
      document.getElementById("restart").style.display = "inline-block";
      return;
    }

    current = terms[Math.floor(Math.random() * terms.length)];
    const wordEl = document.getElementById("word");
    wordEl.innerText = current[0];
    playAudio(current[0]);

    let options = [current];
    const numOptions = Math.min(5, terms.length);
    while (options.length < numOptions) {
      let rand = terms[Math.floor(Math.random() * terms.length)];
      if (!options.includes(rand)) options.push(rand);
    }

    options = options.sort(() => Math.random() - 0.5);

    const optDiv = document.getElementById("options");
    optDiv.innerHTML = "";
    const feedback = document.getElementById("feedback");
    feedback.innerText = "";

    options.forEach(opt => {
      const btn = document.createElement("button");
      btn.className = "option";
      btn.innerText = opt[1];
      btn.setAttribute("dir", "ltr");
      btn.onclick = () => {
        if (opt === current) {
          feedback.innerText = "‚úî –í–µ—Ä–Ω–æ";
          feedback.style.color = "green";
          terms = terms.filter(t => t !== current);
          fadeAndThen(showWord);
        } else {
          feedback.innerText = "‚ùå –û—Ç–≤–µ—Ç: " + current[1];
          feedback.style.color = "red";
          setTimeout(showWord, 6000);
        }
      };
      optDiv.appendChild(btn);
    });
  }

  function skipWord() {
    terms = terms.filter(t => t !== current);
    fadeAndThen(showWord);
  }

  function repeatWord() {
    if (current) playAudio(current[0]);
  }

  document.getElementById("repeat").onclick = repeatWord;
  document.getElementById("skip").onclick = skipWord;
  document.getElementById("restart").onclick = () => {
    terms = [...allTerms];
    document.getElementById("repeat").style.display = "inline-block";
    document.getElementById("skip").style.display = "inline-block";
    document.getElementById("restart").style.display = "none";
    showWord();
  };

  Promise.all([
    fetch("terms.json").then(res => res.json()),
    fetch("audio_map.json").then(res => res.json())
  ]).then(([termsData, audioMapData]) => {
    terms = [...termsData];
    allTerms = [...termsData];
    audioMap = audioMapData;
    showWord();
  });
</script>
</body>
</html>
